# ☁️ 云同步功能使用指南

## 📋 功能概述

云同步功能让你可以在不同设备间同步你的观影清单，支持两种存储方式：

1. **浏览器本地云存储** (IndexedDB) - 默认启用
2. **GitHub Gist** - 需要配置

---

## 🚀 快速开始

### 启用云同步

1. 点击右上角 ⚙️ 设置按钮
2. 找到"☁️ 云端同步"部分
3. 打开"启用云同步"开关
4. 完成！系统会每5分钟自动同步一次

---

## 📦 存储方式详解

### 方式一：浏览器本地云存储 (推荐新手)

**优点**：
- ✅ 无需配置，开箱即用
- ✅ 完全本地，隐私安全
- ✅ 速度快，无网络延迟

**缺点**：
- ❌ 仅限当前浏览器
- ❌ 清除浏览器数据会丢失
- ❌ 无法跨设备同步

**使用场景**：
- 单设备使用
- 作为本地备份
- 不需要跨设备同步

**工作原理**：
使用浏览器的 IndexedDB 数据库存储备份，数据保存在浏览器本地。

---

### 方式二：GitHub Gist (推荐高级用户)

**优点**：
- ✅ 真正的云端存储
- ✅ 跨设备同步
- ✅ 版本控制
- ✅ 永久保存

**缺点**：
- ❌ 需要GitHub账号
- ❌ 需要配置Token
- ❌ 需要网络连接

**使用场景**：
- 多设备使用
- 需要跨设备同步
- 需要长期保存

---

## 🔧 配置 GitHub Gist

### 步骤1：创建 GitHub Personal Access Token

1. 访问 [github.com/settings/tokens](https://github.com/settings/tokens)
2. 点击 "Generate new token" → "Generate new token (classic)"
3. 填写信息：
   - **Note**: `Movie Watchlist Sync`
   - **Expiration**: 选择有效期（建议 No expiration）
   - **Scopes**: 只勾选 `gist` 权限
4. 点击 "Generate token"
5. **重要**：复制生成的 token（只显示一次！）

### 步骤2：在应用中配置

1. 打开设置 → 云端同步 → 云同步设置
2. 点击"配置 GitHub"按钮
3. 粘贴刚才复制的 token
4. 点击确定

### 步骤3：首次同步

1. 点击"立即同步"按钮
2. 系统会自动创建一个私有 Gist
3. Gist ID 会自动保存

### 步骤4：在其他设备上恢复

1. 在新设备上打开应用
2. 配置相同的 GitHub Token
3. 点击"从云端恢复"
4. 确认恢复数据

---

## 💡 使用技巧

### 自动同步

启用云同步后，系统会：
- 每5分钟自动同步一次
- 添加/删除/修改电影时不会立即同步
- 建议重要操作后手动点击"立即同步"

### 手动同步

适用场景：
- 刚添加了重要电影
- 准备关闭浏览器
- 切换到其他设备前

操作：点击"立即同步"按钮

### 从云端恢复

适用场景：
- 新设备首次使用
- 误删除了数据
- 浏览器数据丢失

操作：
1. 点击"从云端恢复"
2. 确认恢复（会覆盖本地数据）

### 多设备同步策略

**推荐流程**：
1. 在主设备上启用云同步
2. 添加/修改电影后，点击"立即同步"
3. 在其他设备上，点击"从云端恢复"
4. 在其他设备上也启用云同步

**注意事项**：
- 不支持自动冲突解决
- 恢复操作会覆盖本地数据
- 建议在一个设备上主要编辑

---

## ⚠️ 注意事项

### 数据安全

1. **GitHub Token 安全**：
   - Token 存储在浏览器 localStorage
   - 清除浏览器数据会丢失 Token
   - 不要分享你的 Token
   - 定期更换 Token

2. **Gist 隐私**：
   - 创建的 Gist 是私有的
   - 只有你能访问
   - 可以在 GitHub 上手动删除

3. **备份建议**：
   - 云同步不能替代导出备份
   - 建议定期使用"导出数据"功能
   - 保存导出的 JSON 文件到安全位置

### 同步限制

1. **GitHub API 限制**：
   - 每小时最多60次请求（未认证）
   - 每小时最多5000次请求（已认证）
   - 正常使用不会超限

2. **数据大小**：
   - Gist 单文件最大 10MB
   - 正常使用不会超限（1000部电影约1MB）

3. **网络要求**：
   - GitHub 同步需要网络连接
   - 本地云存储不需要网络

---

## 🔍 故障排查

### 问题1：同步失败

**可能原因**：
- Token 无效或过期
- 网络连接问题
- GitHub API 限制

**解决方法**：
1. 检查网络连接
2. 重新配置 GitHub Token
3. 稍后再试

### 问题2：无法恢复数据

**可能原因**：
- Gist 不存在
- Token 权限不足
- 网络问题

**解决方法**：
1. 确认已经同步过数据
2. 检查 Token 权限（需要 gist 权限）
3. 尝试重新配置

### 问题3：数据冲突

**场景**：
在多个设备上都修改了数据

**解决方法**：
1. 选择一个设备作为主设备
2. 在主设备上点击"立即同步"
3. 在其他设备上点击"从云端恢复"

### 问题4：Token 丢失

**解决方法**：
1. 在 GitHub 上撤销旧 Token
2. 创建新 Token
3. 重新配置

---

## 📊 同步内容

云同步会保存以下内容：

### 电影数据
- 所有电影信息
- 个人笔记
- 个人评分
- 观看状态
- 添加时间
- 观看时间

### 应用设置
- 当前主题
- 当前字体
- 语言设置
- 透明度设置
- 筛选状态

### 不同步的内容
- GitHub Token（安全考虑）
- 浏览器缓存
- 临时数据

---

## 🎯 最佳实践

### 单设备用户

1. 启用云同步（使用本地云存储）
2. 定期导出数据到文件
3. 重要操作后手动同步

### 多设备用户

1. 配置 GitHub Gist
2. 在主设备上启用云同步
3. 每次编辑后立即同步
4. 在其他设备上定期恢复
5. 定期导出数据备份

### 团队协作（不推荐）

虽然可以共享 Gist，但不建议：
- 容易产生数据冲突
- 没有冲突解决机制
- 建议每人使用独立账号

---

## 🆘 常见问题

### Q: 云同步安全吗？
**A**: 
- 本地云存储：完全安全，数据不离开浏览器
- GitHub Gist：使用 HTTPS 加密传输，Gist 是私有的

### Q: 会消耗多少流量？
**A**: 
- 单次同步约 1-10KB（取决于电影数量）
- 每天自动同步约 300KB（每5分钟一次）

### Q: 可以同时使用两种存储方式吗？
**A**: 
- 可以！配置 GitHub 后会同时使用两种方式
- 本地云存储作为快速备份
- GitHub Gist 作为云端备份

### Q: 如何查看 Gist？
**A**: 
1. 访问 [gist.github.com](https://gist.github.com)
2. 登录你的账号
3. 找到名为 "Movie Watchlist Backup" 的 Gist

### Q: 可以手动编辑 Gist 吗？
**A**: 
- 可以，但不推荐
- 格式错误会导致恢复失败
- 建议使用应用内的编辑功能

### Q: 如何删除云端数据？
**A**: 
- 本地云存储：清除浏览器数据
- GitHub Gist：在 GitHub 上手动删除 Gist

---

## 🔮 未来计划

- [ ] 自动冲突解决
- [ ] 支持更多云存储提供商（Dropbox、Google Drive）
- [ ] 增量同步（只同步变更）
- [ ] 同步历史记录
- [ ] 多账号支持

---

## 📞 获取帮助

如遇到问题：
1. 查看本文档的故障排查部分
2. 检查浏览器控制台的错误信息
3. 尝试清除配置重新设置

---

**版本**: v2.1.0  
**更新日期**: 2026-01-28  
**功能状态**: ✅ 稳定可用

享受云同步带来的便利！☁️✨
